# 快淘帮 WisePick - 产品需求文档 (PRD)

**版本**: 2.0  
**创建日期**: 2024  
**最后更新**: 2026-01-22  
**文档状态**: 正式版

---

## 1. 产品概述

### 1.1 产品定位
快淘帮 WisePick 是一款基于 AI 的智能购物推荐应用，通过自然语言对话帮助用户在多平台（淘宝、京东、拼多多）中快速找到心仪商品，并提供推广链接生成、购物车管理等一站式购物辅助服务。

### 1.2 产品愿景
成为用户最信赖的智能购物助手，通过 AI 技术简化购物决策流程，提升购物体验。

### 1.3 核心价值主张
- **智能推荐**: 基于 AI 理解用户需求，提供个性化商品推荐
- **多平台聚合**: 统一搜索淘宝、京东、拼多多三大电商平台
- **推广链接**: 自动生成联盟推广链接，支持佣金收益
- **选品管理**: 提供购物车功能，方便用户收藏和比价
- **高级爬虫**: 内置京东联盟高级网页爬虫，提升数据获取成功率
- **数据洞察**: 基于购物行为数据，提供消费结构分析和智能偏好分析
- **价格趋势**: 记录价格历史，提供价格趋势分析和最佳购买时机建议
- **决策辅助**: 多维度商品对比和智能购买建议评分系统

---

## 2. 目标用户

### 2.1 主要用户群体
- **购物达人**: 经常网购，需要快速找到性价比高的商品
- **联盟推广者**: 需要生成推广链接进行商品推广
- **价格敏感用户**: 希望在不同平台间比价，找到最优价格
- **决策困难用户**: 需要 AI 辅助进行购物决策

### 2.2 用户画像
- **年龄**: 18-45 岁
- **地域**: 中国大陆
- **设备**: 支持 Windows、macOS、Linux、Android、iOS、Web
- **使用场景**: 日常购物、选品、比价、推广

---

## 3. 核心功能模块

### 3.1 AI 助手聊天模块
**功能描述**: 通过自然语言对话，理解用户购物需求，提供商品推荐和购物建议。

**核心特性**:
- 支持流式响应，实时显示 AI 回复
- 智能识别用户意图（推荐请求 vs 普通问答）
- 支持结构化 JSON 推荐和自然语言回复
- 会话历史管理，支持多会话切换
- 自动生成会话标题

**技术实现**:
- 集成 OpenAI API（支持自定义 API 地址和模型）
- 支持本地代理服务器转发请求
- 支持 Mock 模式用于离线开发
- 可配置 Prompt 嵌入、调试模式等高级选项

**用户故事**:
- 作为用户，我希望通过自然语言描述我的需求，AI 能理解并推荐合适的商品
- 作为用户，我希望看到 AI 实时生成回复，而不是等待完整响应
- 作为用户，我希望能够查看和管理历史对话记录

### 3.2 商品搜索模块
**功能描述**: 支持在淘宝、京东、拼多多三大平台搜索商品，并统一展示结果。

**核心特性**:
- 多平台并行搜索（淘宝、京东、拼多多）
- 搜索结果去重和合并（优先显示京东结果）
- 支持分页加载
- 商品信息统一展示（标题、价格、图片、销量、评分等）
- 支持平台筛选（单平台或全平台）

**技术实现**:
- 使用 Adapter 模式适配不同平台 API
- 统一商品模型 `ProductModel` 封装
- 支持缓存机制提升性能
- **京东高级爬虫**: 针对京东联盟 API 限流和风控，提供基于 Playwright 的自动化爬虫方案

**用户故事**:
- 作为用户，我希望输入关键词后能同时搜索多个平台
- 作为用户，我希望看到统一的商品展示格式，方便比较
- 作为用户，我希望能够按平台筛选搜索结果

### 3.3 商品详情模块
**功能描述**: 展示商品详细信息，包括价格、图片、描述、店铺信息等。

**核心特性**:
- 商品详细信息展示
- 价格历史趋势（如支持）
- 推广链接生成和复制
- 一键加入购物车
- 外部链接跳转

**用户故事**:
- 作为用户，我希望查看商品的详细信息
- 作为用户，我希望能够快速复制推广链接
- 作为用户，我希望能够将感兴趣的商品加入购物车

### 3.4 购物车模块
**功能描述**: 管理用户收藏的商品，支持批量操作和价格监控。

**核心特性**:
- 商品添加/删除
- 按店铺分组显示
- 商品数量调整
- 批量选择/取消选择
- 价格自动刷新（后台服务）
- 结算功能（复制推广链接）
- 价格变化通知

**技术实现**:
- 使用 Hive 本地存储
- Riverpod 状态管理
- 后台价格刷新服务 `PriceRefreshService`
- 本地通知服务 `NotificationService`

**用户故事**:
- 作为用户，我希望能够保存感兴趣的商品到购物车
- 作为用户，我希望购物车中的商品价格能够自动更新
- 作为用户，我希望当商品降价时能收到通知
- 作为用户，我希望能够批量管理购物车中的商品

### 3.5 推广链接生成模块
**功能描述**: 为商品自动生成联盟推广链接，支持淘宝、京东、拼多多。

**核心特性**:
- 自动生成推广链接
- 链接缓存机制（30 分钟有效期）
- 支持强制刷新
- 支持复制链接
- 支持口令（tpwd）和短链接

**技术实现**:
- 后端代理服务处理签名和转链
- 支持淘宝、京东、拼多多不同 API
- 本地缓存和持久化存储

**用户故事**:
- 作为推广者，我希望能够快速为商品生成推广链接
- 作为推广者，我希望生成的链接能够自动缓存，避免重复请求
- 作为推广者，我希望能够复制推广链接或口令

### 3.6 管理员设置模块
**功能描述**: 提供高级配置选项，包括 API 设置、后端配置、调试选项等。

**核心特性**:
- OpenAI API Key 配置
- 后端代理地址配置
- AI 模型选择（支持获取可用模型列表）
- Prompt 嵌入开关
- 调试模式（显示原始 JSON 响应）
- Mock AI 模式（离线开发）
- Max Tokens 配置
- 京东联盟参数配置（subUnionId、pid）

**用户故事**:
- 作为管理员，我希望能够配置 AI API 相关参数
- 作为管理员，我希望能够切换不同的 AI 模型
- 作为开发者，我希望能够启用调试模式查看原始响应

### 3.7 数据分析与洞察模块
**功能描述**: 基于用户购物行为数据，提供消费结构分析、智能偏好分析、购物欲望时间分析等数据洞察功能。

**核心特性**:
- 购物车消费结构分析（品类分布、价格区间、平台偏好）
- 智能偏好分析（基于历史购物行为生成用户画像）
- 购物欲望时间分析（分析用户与AI对话的时间分布模式）
- 数据可视化（饼图、柱状图、折线图、热力图等）
- 购物报告生成（月度/年度消费报告，支持PDF导出）

**技术实现**:
- 使用 fl_chart 或类似图表库进行数据可视化
- 基于购物车和会话历史数据进行统计分析
- 支持数据导出（JSON、Excel、PDF格式）
- 本地数据分析和云端数据聚合（如已登录）

**用户故事**:
- 作为用户，我希望了解我的购物偏好和消费习惯
- 作为用户，我希望看到我的消费结构分析图表
- 作为用户，我希望了解我在什么时间段购物欲望最强
- 作为用户，我希望能够生成月度购物报告

### 3.8 价格历史与趋势模块
**功能描述**: 记录和展示商品价格历史，提供价格趋势分析和购买时机建议。

**核心特性**:
- 商品价格历史记录（自动记录购物车商品价格变化）
- 价格历史曲线图（支持多商品对比）
- 价格波动分析（涨跌幅度、波动频率）
- 最佳购买时机推荐（基于历史价格数据）
- 价格预测（基于历史趋势的简单预测）

**技术实现**:
- 使用 Hive 存储价格历史数据（时间序列数据）
- 图表展示使用 fl_chart 或类似库
- 价格数据自动采集（与价格监控服务集成）
- 支持数据导出和分享

**用户故事**:
- 作为用户，我希望查看商品的价格历史曲线
- 作为用户，我希望了解商品价格是否处于历史低位
- 作为用户，我希望获得最佳购买时机的建议
- 作为用户，我希望对比多个商品的价格趋势

### 3.9 购物决策助手增强模块
**功能描述**: 在原有AI助手基础上，增强购物决策辅助功能，提供多维度商品对比和智能购买建议。

**核心特性**:
- 多商品对比分析（参数对比表、价格对比、评价对比）
- 购买建议评分系统（综合价格、评价、销量、历史趋势等因素）
- 替代商品推荐（基于相似度算法）
- 购买决策理由解释（AI生成购买建议的详细理由）
- 决策时间分析（记录用户从浏览到决策的时间）

**技术实现**:
- 扩展 AI Prompt，增加决策分析能力
- 多维度评分算法（价格、评价、销量、历史趋势等权重计算）
- 商品相似度算法（基于商品属性、类别、价格区间）
- 决策数据记录和分析

**用户故事**:
- 作为用户，我希望能够对比多个商品的详细参数
- 作为用户，我希望获得综合评分最高的商品推荐
- 作为用户，我希望了解为什么推荐这个商品
- 作为用户，我希望看到替代商品选项

### 3.10 管理员后台模块
**功能描述**: 为管理员提供系统管理后台，包括用户数据统计、系统使用情况分析、商品搜索热词统计等功能。

**核心特性**:
- 用户数据统计面板（总用户数、活跃用户、留存率等）
- 系统使用情况分析（API调用统计、搜索成功率、错误率等）
- 商品搜索热词统计（热门搜索词、搜索趋势）
- 用户行为分析（会话时长、购物车转化率等）
- 数据导出功能（支持导出统计数据为Excel或CSV）
- 系统配置管理（API配置、爬虫参数等）

**技术实现**:
- 后端提供管理API接口（需要管理员权限验证）
- **独立的前端管理后台项目**（Flutter Web应用，与主应用分离）
- 数据聚合和统计分析（基于数据库查询）
- 实时数据刷新（WebSocket或定时轮询）
- 独立部署，可通过独立域名访问（如 `admin.wisepick.com`）

**用户故事**:
- 作为管理员，我希望查看系统整体使用情况
- 作为管理员，我希望了解用户搜索偏好和热门商品
- 作为管理员，我希望监控系统性能和错误率
- 作为管理员，我希望导出统计数据用于分析

---

## 4. 技术架构

### 4.1 前端架构
**技术栈**:
- **框架**: Flutter (Dart 3.9.2+)
- **状态管理**: Riverpod 2.5.1
- **本地存储**: Hive 2.2.3
- **网络请求**: Dio 5.1.2
- **UI 组件**: Material Design 3
- **字体**: Noto Sans SC（中文字体支持）
- **图表库**: fl_chart（数据可视化）
- **PDF生成**: pdf 或 printing（报告生成）
- **Excel导出**: excel（数据导出）

**架构模式**:
- **MVVM**: 使用 Riverpod 进行状态管理
- **Adapter 模式**: 商品搜索适配不同平台
- **Service 层**: 业务逻辑封装在 Service 中
- **Repository 模式**: 数据访问层抽象

**目录结构**:
```
lib/
├── core/              # 核心功能（API 客户端、配置、OAuth 等）
├── features/           # 功能模块
│   ├── chat/          # 聊天功能
│   ├── products/      # 商品功能
│   ├── cart/          # 购物车功能
│   ├── analytics/     # 数据分析功能
│   ├── price_history/ # 价格历史功能
│   ├── decision/      # 购物决策功能
│   └── admin/         # 管理员后台
├── screens/           # 页面组件
├── services/          # 业务服务
│   ├── sync/          # 数据同步
│   └── analytics/     # 数据分析服务
├── widgets/           # 通用组件
│   └── charts/        # 图表组件
└── models/            # 数据模型
```

### 4.2 后端架构
**技术栈**:
- **语言**: Dart
- **框架**: Shelf
- **功能**: 代理服务器、API 签名、转链

**核心功能**:
- OpenAI API 代理转发
- 淘宝联盟签名和转链 (`/sign/taobao`, `/taobao/convert`)
- 京东联盟签名和转链 (`/sign/jd`, `/jd/union/promotion/bysubunionid`)
- 拼多多推广链接生成 (`/sign/pdd`)
- 管理员登录验证 (`/admin/login`)

**环境变量配置**:
- `TAOBAO_APP_SECRET`: 淘宝应用密钥
- `JD_APP_SECRET`: 京东联盟密钥
- `JD_APP_KEY`: 京东应用 Key
- `JD_UNION_ID`: 京东联盟 ID
- `PDD_CLIENT_ID`: 拼多多客户端 ID
- `PDD_CLIENT_SECRET`: 拼多多客户端密钥
- `PDD_PID`: 拼多多推广位 ID
- `ADMIN_PASSWORD`: 管理员密码

### 4.3 数据存储
**本地存储**:
- **Hive**: 用于存储设置、购物车、会话历史、推广链接缓存、价格历史等
- **存储内容**:
  - `settings`: 应用设置（API Key、后端地址等）
  - `cart`: 购物车数据
  - `conversations`: 会话历史
  - `promo_cache`: 推广链接缓存
  - `price_history`: 商品价格历史数据（时间序列）
  - `user_preferences`: 用户偏好数据（如已登录）
  - `analytics_cache`: 数据分析缓存

**云端存储**（如已登录）:
- **PostgreSQL**: 用户账号、购物车同步、会话同步、价格历史、统计数据
- **数据同步**: 增量同步机制，支持多端数据一致性

### 4.4 跨平台支持
- **桌面端**: Windows、macOS、Linux
- **移动端**: Android、iOS
- **Web**: 浏览器支持

---

## 5. 功能需求详细说明

### 5.1 AI 助手聊天功能

#### 5.1.1 基础对话
- **需求**: 用户可以通过文本输入与 AI 进行对话
- **输入**: 用户文本消息
- **输出**: AI 文本回复（支持流式响应）
- **优先级**: P0（核心功能）

#### 5.1.2 商品推荐
- **需求**: AI 能够识别用户推荐请求，返回结构化商品推荐
- **输入**: 用户描述需求（如"推荐一款 800 元左右的 USB DAC"）
- **输出**: JSON 格式推荐列表，包含商品信息、价格、链接等
- **优先级**: P0（核心功能）

#### 5.1.3 会话管理
- **需求**: 支持多会话，每个会话有独立标题和历史记录
- **功能**: 创建新会话、切换会话、删除会话、自动保存
- **优先级**: P1（重要功能）

#### 5.1.4 流式响应
- **需求**: AI 回复支持流式显示，提升用户体验
- **技术**: SSE (Server-Sent Events) 或类似流式协议
- **优先级**: P1（重要功能）

### 5.2 商品搜索功能

#### 5.2.1 关键词搜索
- **需求**: 用户输入关键词，搜索多个平台商品
- **支持平台**: 淘宝、京东、拼多多
- **搜索模式**: 单平台搜索、全平台搜索
- **优先级**: P0（核心功能）

#### 5.2.2 搜索结果展示
- **需求**: 统一展示不同平台的商品信息
- **展示内容**: 商品图片、标题、价格、销量、评分、店铺名
- **排序**: 默认按平台优先级（京东 > 淘宝 > 拼多多）
- **优先级**: P0（核心功能）

#### 5.2.3 分页加载
- **需求**: 支持分页加载更多商品
- **默认**: 每页 10 条
- **优先级**: P1（重要功能）

### 5.3 购物车功能

#### 5.3.1 添加商品
- **需求**: 从商品列表或详情页添加商品到购物车
- **功能**: 支持数量设置、自动去重
- **优先级**: P0（核心功能）

#### 5.3.2 商品管理
- **需求**: 支持删除、修改数量、批量选择
- **功能**: 按店铺分组、全选/取消全选
- **优先级**: P0（核心功能）

#### 5.3.3 价格监控
- **需求**: 自动刷新购物车中商品价格
- **频率**: 可配置（建议 5-10 分钟）
- **通知**: 价格变化时发送本地通知
- **优先级**: P1（重要功能）

#### 5.3.4 结算功能
- **需求**: 批量复制选中商品的推广链接
- **功能**: 显示商品列表，支持单个或批量复制
- **优先级**: P1（重要功能）

### 5.4 推广链接生成

#### 5.4.1 自动生成
- **需求**: 为商品自动生成推广链接
- **支持平台**: 淘宝、京东、拼多多
- **链接类型**: 普通链接、短链接、口令（tpwd）
- **优先级**: P0（核心功能）

#### 5.4.2 链接缓存
- **需求**: 生成的链接缓存 30 分钟，避免重复请求
- **存储**: 内存缓存 + Hive 持久化
- **优先级**: P1（重要功能）

#### 5.4.3 链接复制
- **需求**: 一键复制推广链接到剪贴板
- **功能**: 支持复制链接、复制口令
- **优先级**: P0（核心功能）

### 5.5 管理员设置

#### 5.5.1 API 配置
- **需求**: 配置 OpenAI API Key、后端地址、模型等
- **功能**: 支持保存、验证、重置
- **优先级**: P1（重要功能）

#### 5.5.2 高级选项
- **需求**: 提供调试、Mock 模式等高级选项
- **功能**: Prompt 嵌入开关、调试模式、Mock AI、Max Tokens 配置
- **优先级**: P2（可选功能）

### 5.6 数据分析与洞察功能

#### 5.6.1 消费结构分析
- **需求**: 分析用户购物车中的消费结构，包括品类分布、价格区间、平台偏好等
- **功能**: 
  - 品类分布饼图（按商品类别统计）
  - 价格区间柱状图（0-100、100-500、500-1000等区间）
  - 平台偏好分析（淘宝、京东、拼多多的商品占比）
  - 消费金额统计（总金额、平均单价、最高/最低价）
- **数据来源**: 购物车历史数据、当前购物车数据
- **优先级**: P1（重要功能）

#### 5.6.2 智能偏好分析
- **需求**: 基于用户历史购物行为，生成用户购物偏好画像
- **功能**:
  - 偏好品类识别（最常购买的3-5个品类）
  - 价格偏好分析（偏好的价格区间）
  - 品牌偏好（如果有品牌信息）
  - 平台偏好（最常使用的平台）
  - 购物频率分析（平均购物间隔）
- **技术**: 基于历史数据的统计分析，使用标签和权重算法
- **优先级**: P1（重要功能）

#### 5.6.3 购物欲望时间分析
- **需求**: 分析用户与AI对话发起的时间分布，识别购物欲望高峰期
- **功能**:
  - 24小时时间分布热力图（显示不同时段的对话频率）
  - 工作日vs周末对比分析
  - 购物欲望高峰期识别（标注高活跃时段）
  - 时间趋势分析（按周/月展示趋势）
- **数据来源**: 会话历史数据（会话创建时间）
- **可视化**: 热力图、折线图、柱状图
- **优先级**: P1（重要功能）

#### 5.6.4 购物报告生成
- **需求**: 生成月度/年度购物报告，包含消费统计、偏好分析等
- **功能**:
  - 报告时间范围选择（本月、上月、自定义范围）
  - 报告内容：消费总额、商品数量、品类分布、价格趋势等
  - 报告格式：支持PDF导出、图片分享
  - 报告模板：美观的报告模板设计
- **优先级**: P2（可选功能）

### 5.7 价格历史与趋势功能

#### 5.7.1 价格历史记录
- **需求**: 自动记录购物车中商品的价格变化历史
- **功能**:
  - 价格采集频率：每次价格刷新时记录（与价格监控服务集成）
  - 数据存储：时间序列数据，包含时间戳、价格、价格变化幅度
  - 数据保留：至少保留90天历史数据
- **优先级**: P1（重要功能）

#### 5.7.2 价格历史曲线图
- **需求**: 以图表形式展示商品价格历史趋势
- **功能**:
  - 单商品价格曲线（折线图，显示价格随时间的变化）
  - 多商品价格对比（在同一图表中对比多个商品）
  - 价格区间标注（标注历史最高价、最低价、平均价）
  - 价格变化标注（标注降价、涨价事件）
  - 交互功能：缩放、时间范围选择、数据点悬停显示详情
- **可视化**: 使用 fl_chart 或类似图表库
- **优先级**: P1（重要功能）

#### 5.7.3 价格波动分析
- **需求**: 分析商品价格的波动情况
- **功能**:
  - 波动幅度统计（最大涨幅、最大跌幅、平均波动幅度）
  - 波动频率分析（价格变化次数、变化频率）
  - 稳定性评分（价格波动越小，稳定性越高）
- **优先级**: P2（可选功能）

#### 5.7.4 最佳购买时机推荐
- **需求**: 基于历史价格数据，推荐最佳购买时机
- **功能**:
  - 历史最低价提醒（当前价格接近历史最低价时提示）
  - 价格趋势判断（上涨趋势、下跌趋势、平稳）
  - 购买建议（建议立即购买、建议等待、建议观望）
  - 简单价格预测（基于历史趋势的线性预测）
- **优先级**: P1（重要功能）

### 5.8 购物决策助手增强功能

#### 5.8.1 多商品对比分析
- **需求**: 支持同时对比多个商品的详细参数
- **功能**:
  - 对比维度：价格、评分、销量、店铺、参数规格等
  - 对比表格：清晰的表格展示，支持排序
  - 差异高亮：自动标注商品间的关键差异
  - 对比商品数量：支持2-5个商品同时对比
- **优先级**: P1（重要功能）

#### 5.8.2 购买建议评分系统
- **需求**: 为商品生成综合评分，辅助购买决策
- **评分维度**:
  - 价格评分（0-25分）：价格合理性、性价比
  - 评价评分（0-25分）：用户评价、好评率
  - 销量评分（0-20分）：销量数据、市场认可度
  - 历史趋势评分（0-15分）：价格趋势、稳定性
  - 平台评分（0-15分）：平台信誉、服务质量
- **功能**:
  - 综合评分计算（加权平均，总分100分）
  - 评分详情展示（各维度得分和权重）
  - 评分排序（按综合评分排序推荐）
- **优先级**: P1（重要功能）

#### 5.8.3 替代商品推荐
- **需求**: 基于商品相似度，推荐替代商品选项
- **功能**:
  - 相似度算法：基于商品类别、价格区间、功能属性
  - 推荐数量：每个商品推荐2-3个替代选项
  - 推荐理由：说明为什么推荐这些替代商品
- **优先级**: P2（可选功能）

#### 5.8.4 决策理由解释
- **需求**: AI生成购买建议的详细理由，增强用户信任
- **功能**:
  - 理由维度：价格优势、评价质量、销量表现、历史趋势等
  - 自然语言生成：使用AI生成易读的理由说明
  - 理由展示：在商品推荐卡片中显示
- **优先级**: P1（重要功能）

### 5.9 管理员后台功能

#### 5.9.1 用户数据统计
- **需求**: 统计和分析用户数据
- **功能**:
  - 总用户数、活跃用户数（日活、周活、月活）
  - 用户留存率（次日留存、7日留存、30日留存）
  - 用户增长趋势（新增用户数、增长率）
  - 用户地域分布（如支持）
- **可视化**: 数据面板、趋势图表
- **优先级**: P1（重要功能）

#### 5.9.2 系统使用情况分析
- **需求**: 监控系统使用情况和性能指标
- **功能**:
  - API调用统计（调用次数、成功率、平均响应时间）
  - 搜索成功率（各平台搜索成功率）
  - 错误率统计（错误类型、错误频率）
  - 系统负载监控（请求量、响应时间分布）
- **优先级**: P1（重要功能）

#### 5.9.3 商品搜索热词统计
- **需求**: 统计和分析用户搜索行为
- **功能**:
  - 热门搜索词排行榜（Top 20）
  - 搜索趋势分析（按日/周/月展示搜索量趋势）
  - 搜索词分类统计（按商品类别统计）
  - 搜索失败词统计（搜索无结果的词）
- **可视化**: 词云图、柱状图、趋势图
- **优先级**: P1（重要功能）

#### 5.9.4 用户行为分析
- **需求**: 分析用户使用应用的行为模式
- **功能**:
  - 平均会话时长统计
  - 购物车转化率（从浏览到加入购物车的转化率）
  - 功能使用频率（各功能模块的使用次数）
  - 用户路径分析（用户使用流程）
- **优先级**: P2（可选功能）

#### 5.9.5 数据导出功能
- **需求**: 支持导出统计数据用于进一步分析
- **功能**:
  - 导出格式：Excel、CSV、JSON
  - 导出内容：用户数据、搜索数据、系统数据等
  - 导出时间范围选择
- **优先级**: P2（可选功能）

---

## 6. 非功能性需求

### 6.1 性能需求
- **响应时间**: AI 回复首次响应 < 3 秒（流式）
- **搜索速度**: 多平台搜索 < 5 秒
- **页面加载**: 应用启动 < 2 秒
- **流畅度**: 60 FPS 动画
- **数据分析**: 消费结构分析计算 < 1 秒，图表渲染 < 500ms
- **价格历史**: 价格历史数据加载 < 2 秒（90天数据）
- **图表交互**: 图表缩放、拖拽响应 < 100ms
- **报告生成**: PDF报告生成 < 5 秒

### 6.2 可用性需求
- **易用性**: 界面简洁直观，新用户 5 分钟内上手
- **可访问性**: 支持深色模式、系统字体设置
- **多语言**: 主要支持中文（简体）

### 6.3 可靠性需求
- **错误处理**: 网络错误、API 错误有友好提示
- **数据持久化**: 购物车、会话历史本地持久化
- **离线支持**: 支持查看本地缓存数据（Mock 模式）

### 6.4 安全性需求
- **API Key 保护**: 本地加密存储，不提交到版本控制
- **管理员验证**: 管理员入口需要密码验证
- **HTTPS**: 生产环境使用 HTTPS 通信

### 6.5 兼容性需求
- **操作系统**: Windows 10+, macOS 10.14+, Linux (主流发行版)
- **移动端**: Android 5.0+, iOS 12.0+
- **浏览器**: Chrome 90+, Safari 14+, Firefox 88+

### 6.6 可维护性需求
- **代码质量**: 遵循 Flutter/Dart 最佳实践
- **测试覆盖**: 核心功能单元测试覆盖 > 60%
- **文档**: API 文档、代码注释完善

---

## 7. 用户界面设计

### 7.1 设计原则
- **Material Design 3**: 遵循 Material Design 设计规范
- **响应式布局**: 支持桌面端和移动端自适应
- **深色模式**: 支持系统级深色模式切换

### 7.2 主要页面

#### 7.2.1 聊天页面
- **布局**: 消息列表 + 输入框 + 建议卡片
- **交互**: 发送消息、流式显示、商品卡片点击
- **功能**: 会话切换、清空对话、复制消息

#### 7.2.2 购物车页面
- **布局**: 商品列表（按店铺分组）+ 底部结算栏
- **交互**: 选择、删除、数量调整、结算
- **功能**: 全选、按店铺筛选、价格刷新

#### 7.2.3 商品详情页面
- **布局**: 商品图片、信息、操作按钮
- **交互**: 查看详情、加入购物车、复制链接
- **功能**: 外部链接跳转、分享

#### 7.2.4 设置页面
- **布局**: 分类设置卡片
- **交互**: 输入、选择、开关
- **功能**: 保存设置、重置、验证

#### 7.2.5 数据分析页面
- **布局**: 数据面板 + 图表展示区域
- **交互**: 时间范围选择、图表交互（缩放、悬停）
- **功能**: 消费结构分析、偏好分析、时间分析、报告生成

#### 7.2.6 价格历史页面
- **布局**: 商品选择器 + 价格曲线图
- **交互**: 商品选择、时间范围选择、多商品对比切换
- **功能**: 价格历史查看、趋势分析、购买时机建议

#### 7.2.7 商品对比页面
- **布局**: 对比表格 + 评分卡片
- **交互**: 商品选择、排序、详情展开
- **功能**: 多商品对比、评分展示、决策理由查看

#### 7.2.8 管理员后台页面
- **布局**: 数据面板 + 统计图表 + 数据表格
- **交互**: 时间范围选择、数据筛选、导出操作
- **功能**: 用户统计、系统监控、搜索热词、数据导出

---

## 8. 数据模型

### 8.1 商品模型 (ProductModel)
```dart
{
  id: String,              // 商品 ID
  platform: String,        // 平台 (taobao/jd/pdd)
  title: String,          // 商品标题
  price: double,          // 价格
  originalPrice: double,  // 原价
  coupon: double,         // 优惠券金额
  finalPrice: double,     // 最终价格
  imageUrl: String,       // 图片 URL
  sales: int,             // 销量
  rating: double,         // 评分 (0.0-1.0)
  shopTitle: String,      // 店铺名
  link: String,           // 商品链接
  commission: double,     // 佣金
  description: String     // 描述
}
```

### 8.2 消息模型 (ChatMessage)
```dart
{
  id: String,             // 消息 ID
  role: String,           // 角色 (user/assistant)
  content: String,        // 消息内容
  timestamp: DateTime,    // 时间戳
  products: List<ProductModel>?  // 关联商品（可选）
}
```

### 8.3 会话模型 (Conversation)
```dart
{
  id: String,             // 会话 ID
  title: String,          // 会话标题
  messages: List<ChatMessage>,  // 消息列表
  createdAt: DateTime,    // 创建时间
  updatedAt: DateTime     // 更新时间
}
```

### 8.4 价格历史模型 (PriceHistory)
```dart
{
  productId: String,      // 商品 ID
  platform: String,       // 平台 (taobao/jd/pdd)
  timestamp: DateTime,    // 记录时间
  price: double,          // 价格
  originalPrice: double?, // 原价（如有）
  priceChange: double,    // 价格变化（相对于上次）
  priceChangePercent: double, // 价格变化百分比
}
```

### 8.5 用户偏好模型 (UserPreference)
```dart
{
  userId: String,         // 用户 ID（如已登录）
  preferredCategories: List<String>, // 偏好品类列表
  priceRange: {          // 价格偏好区间
    min: double,
    max: double,
  },
  preferredPlatforms: List<String>, // 偏好平台列表
  shoppingFrequency: double, // 购物频率（次/月）
  lastUpdated: DateTime, // 最后更新时间
}
```

### 8.6 购物决策模型 (PurchaseDecision)
```dart
{
  productId: String,      // 商品 ID
  score: double,          // 综合评分 (0-100)
  priceScore: double,     // 价格评分 (0-25)
  ratingScore: double,    // 评价评分 (0-25)
  salesScore: double,     // 销量评分 (0-20)
  trendScore: double,     // 趋势评分 (0-15)
  platformScore: double,  // 平台评分 (0-15)
  reasoning: String,      // 决策理由（AI生成）
  alternatives: List<String>, // 替代商品ID列表
  createdAt: DateTime,    // 创建时间
}
```

### 8.7 统计数据模型 (StatisticsData)
```dart
{
  // 用户统计
  totalUsers: int,
  activeUsers: {          // 活跃用户
    daily: int,
    weekly: int,
    monthly: int,
  },
  retentionRate: {       // 留存率
    day1: double,
    day7: double,
    day30: double,
  },
  
  // 系统统计
  apiCalls: {            // API调用统计
    total: int,
    success: int,
    failed: int,
    avgResponseTime: double,
  },
  searchStats: {         // 搜索统计
    totalSearches: int,
    successRate: double,
    topKeywords: List<{keyword: String, count: int}>,
  },
  
  // 时间范围
  period: {              // 统计周期
    start: DateTime,
    end: DateTime,
  },
}
```

---

## 9. API 接口设计

### 9.1 前端调用后端接口

#### 9.1.1 AI 聊天接口
- **端点**: `POST /v1/chat/completions`
- **功能**: 获取 AI 回复（支持流式）
- **请求体**: OpenAI 兼容格式
- **响应**: JSON 或 SSE 流

#### 9.1.2 推广链接与爬虫接口
- **淘宝**: `POST /sign/taobao` 或 `POST /taobao/convert`
- **京东 API**: `POST /sign/jd` 或 `POST /jd/union/promotion/bysubunionid`
- **京东爬虫**: `POST /jd/product`, `POST /jd/products/batch`, `POST /jd/cookie/refresh`
- **拼多多**: `POST /sign/pdd`

#### 9.1.3 管理员接口
- **登录**: `POST /admin/login`
- **功能**: 验证管理员密码

#### 9.1.4 数据分析接口
- **消费结构分析**: `GET /api/v1/analytics/consumption-structure`
  - 功能: 获取用户消费结构分析数据
  - 参数: `userId`（可选，如已登录）、`timeRange`（时间范围）
  - 响应: 品类分布、价格区间、平台偏好等数据
  
- **偏好分析**: `GET /api/v1/analytics/preferences`
  - 功能: 获取用户购物偏好分析
  - 参数: `userId`（可选）
  - 响应: 偏好品类、价格区间、平台偏好等
  
- **购物欲望时间分析**: `GET /api/v1/analytics/shopping-time`
  - 功能: 获取用户购物欲望时间分布数据
  - 参数: `userId`（可选）、`timeRange`
  - 响应: 24小时分布数据、工作日/周末对比等

#### 9.1.5 价格历史接口
- **获取价格历史**: `GET /api/v1/price-history/{productId}`
  - 功能: 获取指定商品的价格历史数据
  - 参数: `productId`、`days`（查询天数，默认90天）
  - 响应: 价格历史时间序列数据
  
- **批量获取价格历史**: `POST /api/v1/price-history/batch`
  - 功能: 批量获取多个商品的价格历史
  - 请求体: `{productIds: List<String>, days: int}`
  - 响应: 多个商品的价格历史数据

#### 9.1.6 购物决策接口
- **商品对比**: `POST /api/v1/decision/compare`
  - 功能: 对比多个商品的详细信息
  - 请求体: `{productIds: List<String>}`
  - 响应: 对比数据（价格、评分、参数等）
  
- **购买建议评分**: `POST /api/v1/decision/score`
  - 功能: 为商品生成购买建议评分
  - 请求体: `{productId: String}`
  - 响应: 综合评分、各维度得分、决策理由

#### 9.1.7 管理员后台接口
- **用户统计**: `GET /api/v1/admin/users/stats`
  - 功能: 获取用户统计数据
  - 权限: 需要管理员认证
  - 响应: 用户数、活跃用户、留存率等
  
- **系统统计**: `GET /api/v1/admin/system/stats`
  - 功能: 获取系统使用情况统计
  - 权限: 需要管理员认证
  - 响应: API调用统计、搜索成功率、错误率等
  
- **搜索热词**: `GET /api/v1/admin/search/keywords`
  - 功能: 获取商品搜索热词统计
  - 权限: 需要管理员认证
  - 参数: `limit`（返回数量，默认20）、`timeRange`
  - 响应: 热门搜索词列表及搜索次数

### 9.2 第三方 API 集成

#### 9.2.1 淘宝联盟 API
- **搜索**: 通过后端代理
- **转链**: 后端处理签名和转链

#### 9.2.2 京东联盟 API
- **搜索**: 直接调用或通过后端
- **转链**: 后端处理签名和转链

#### 9.2.3 拼多多 API
- **搜索**: 直接调用
- **转链**: 后端处理签名和转链

---

## 10. 错误处理

### 10.1 网络错误
- **处理**: 显示友好错误提示，支持重试
- **提示**: "网络连接失败，请检查网络设置"

### 10.2 API 错误
- **处理**: 根据错误码显示不同提示
- **常见错误**:
  - 429: 请求过多，提示稍后重试
  - 401: API Key 无效，提示检查配置
  - 500: 服务器错误，提示联系管理员

### 10.3 数据错误
- **处理**: 数据解析失败时使用默认值或跳过
- **日志**: 记录错误信息便于调试

---

## 11. 测试策略

### 11.1 单元测试
- **覆盖范围**: Service 层、Adapter 层、工具函数
- **测试文件**: `test/` 目录
- **覆盖率目标**: > 60%

### 11.2 集成测试
- **覆盖范围**: API 调用、数据存储、状态管理
- **测试场景**: 完整用户流程

### 11.3 UI 测试
- **覆盖范围**: 主要页面交互
- **测试工具**: Flutter Widget Tests

### 11.4 手动测试
- **测试场景**: 多平台搜索、AI 对话、购物车操作
- **测试设备**: 不同操作系统、不同屏幕尺寸

---

## 12. 部署和发布

### 12.1 前端部署
- **桌面端**: 打包为可执行文件（Windows .exe, macOS .app, Linux AppImage）
- **移动端**: 发布到应用商店（Android Google Play, iOS App Store）
- **Web**: 部署到静态托管服务（如 Vercel、Netlify）

### 12.2 后端部署
- **服务器**: 支持 Linux 服务器部署
- **运行方式**: `dart run server/bin/proxy_server.dart`
- **进程管理**: 建议使用 PM2 或 systemd
- **环境变量**: 通过 `.env` 文件或系统环境变量配置

### 12.3 版本管理
- **版本号**: 遵循语义化版本（Semantic Versioning）
- **发布流程**: 开发 → 测试 → 预发布 → 正式发布

---

## 13. 未来规划

### 13.1 短期规划 (3 个月内)
- [ ] 优化 AI 推荐准确性
- [ ] 增加更多商品筛选条件（价格区间、销量排序等）
- [ ] 完善价格监控和通知功能
- [ ] 支持更多电商平台（如天猫、苏宁等）

### 13.2 中期规划 (6 个月内)
- [x] 用户账户系统（云同步购物车和会话）✅ 已完成
- [x] 商品比价功能（同一商品在不同平台的价格对比）✅ 已规划
- [ ] 商品评价分析（AI 分析用户评价）
- [ ] 优惠券聚合和提醒
- [x] 数据分析与洞察功能 ✅ 已规划
- [x] 价格历史与趋势功能 ✅ 已规划
- [x] 购物决策助手增强 ✅ 已规划
- [x] 管理员后台 ✅ 已规划

### 13.3 长期规划 (1 年内)
- [ ] 社交功能（分享选品清单、推荐给好友）
- [ ] 数据分析（用户购物偏好分析、推荐优化）
- [ ] 开放 API（供第三方开发者集成）
- [ ] 多语言支持（英文、繁体中文等）

---

## 14. 风险评估

### 14.1 技术风险
- **API 依赖**: 第三方 API 变更可能导致功能失效
  - **缓解措施**: 使用 Adapter 模式，便于替换实现
- **AI 成本**: OpenAI API 调用成本可能较高
  - **缓解措施**: 支持本地代理、Mock 模式、缓存机制

### 14.2 业务风险
- **平台政策**: 电商平台可能限制 API 访问
  - **缓解措施**: 多样化平台支持，降低单平台依赖
- **推广合规**: 需要遵守各平台推广规则
  - **缓解措施**: 明确提示用户遵守平台规则

### 14.3 用户风险
- **数据隐私**: 用户数据本地存储，不涉及隐私泄露
- **API Key 安全**: 用户自行保管 API Key，应用不收集

---

## 15. 成功指标

### 15.1 用户指标
- **日活跃用户 (DAU)**: 目标 1000+
- **用户留存率**: 7 日留存 > 30%
- **平均会话时长**: > 5 分钟

### 15.2 功能指标
- **AI 推荐准确率**: 用户满意度 > 70%
- **搜索成功率**: 搜索成功率 > 95%
- **推广链接生成成功率**: > 90%

### 15.3 技术指标
- **应用崩溃率**: < 0.1%
- **API 响应时间**: 平均 < 2 秒
- **页面加载时间**: < 1 秒

---

## 16. 附录

### 16.1 术语表
- **推广链接**: 包含推广者信息的商品链接，用户通过该链接购买推广者可获得佣金
- **购物车**: 用户收藏感兴趣商品的列表，类似购物车
- **转链**: 将普通商品链接转换为推广链接的过程
- **tpwd**: 淘宝口令，一种短链接形式
- **Adapter 模式**: 设计模式，用于适配不同平台的 API

### 16.2 参考文档
- [Flutter 官方文档](https://docs.flutter.dev/)
- [OpenAI API 文档](https://platform.openai.com/docs)
- [淘宝联盟 API](https://open.taobao.com/)
- [京东联盟 API](https://union.jd.com/)
- [拼多多开放平台](https://open.pinduoduo.com/)

### 16.3 变更日志
- **v2.0** (2026-01-22): 
  - 新增数据分析与洞察模块（消费结构分析、智能偏好分析、购物欲望时间分析）
  - 新增价格历史与趋势模块（价格历史记录、价格曲线图、购买时机推荐）
  - 新增购物决策助手增强模块（多商品对比、购买建议评分、替代商品推荐）
  - 新增管理员后台模块（用户统计、系统监控、搜索热词统计）
  - 更新数据模型（价格历史、用户偏好、购物决策、统计数据）
  - 更新API接口设计（新增数据分析、价格历史、决策、管理员后台接口）
- **v1.0** (2025): 初始 PRD 版本

---

**文档维护者**: 产品团队  
**审核者**: 技术团队、设计团队  
**批准者**: 产品负责人

